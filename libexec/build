#!/bin/sh -u

printf 'Cleaning up ... '

command './clean' > '/dev/null' 2>&1

echo 'done.'

printf 'Copying source files ... '

cp -R '../src' '../build' > '/dev/null' 2>&1

__dotfiles_repo__build_cp_exit_status=$?

if [ $__dotfiles_repo__build_cp_exit_status -eq 0 ]; then
  echo 'succeeded.'

  unset -v '__dotfiles_repo__build_cp_exit_status'
else
  echo 'failed.'

  exit $__dotfiles_repo__build_cp_exit_status
fi

if [ -e '../vendor/git/github.com/ChristianGrete/dotfiles-cli/dist' ]; then
  printf 'Making target directory for CLI ... '

  mkdir '../build/opt/dotfiles.christiangrete.com' > '/dev/null' 2>&1

  __dotfiles_repo__build_mkdir_exit_status=$?

  if [ $__dotfiles_repo__build_mkdir_exit_status -eq 0 ]; then
    echo 'succeeded.'

    unset -v '__dotfiles_repo__build_mkdir_exit_status'
  else
    echo 'failed.'

    exit $__dotfiles_repo__build_mkdir_exit_status
  fi

  printf 'Copying CLI artifact to target directory ... '

  cp -R '../vendor/git/github.com/ChristianGrete/dotfiles-cli/dist' \
    '../build/opt/dotfiles.christiangrete.com/cli' > '/dev/null' 2>&1

  __dotfiles_repo__build_cp_exit_status=$?

  if [ $__dotfiles_repo__build_cp_exit_status -eq 0 ]; then
    echo 'succeeded.'

    unset -v '__dotfiles_repo__build_cp_exit_status'
  else
    echo 'failed.'

    exit $__dotfiles_repo__build_cp_exit_status
  fi
fi
